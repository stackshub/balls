!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){function i(t,e,i,s,n){for(var o in this.x=t,this.y=e,this.w=i,this.h=s,n)this[o]=n[o]}t.exports=i,Object.defineProperties(i.prototype,{cx:{get:function(){return this.x+this.w/2},set:function(t){this.x=t-this.w/2}},cy:{get:function(){return this.y+this.h/2},set:function(t){this.y=t-this.h/2}},r:{get:function(){return Math.min(Math.abs(this.w)/2,Math.abs(this.h)/2)},set:function(t){var e=this.cx,i=this.cy;if(!(t>0))return this.w=this.h=0,this.x=e,void(this.y=i);var s=this.r;if(!(s>0))return this.w=this.h=t,this.x=e-t/2,void(this.y=i-t/2);var n=t/s;this.w*=n,this.h*=n,this.x=e-this.w/2,this.y=i-this.h/2}},nx:{get:function(){return this.w>=0?this.x:this.x+this.w},set:function(t){this.x=this.w>=0?t:t-this.w}},ny:{get:function(){return this.h>=0?this.y:this.y+this.h},set:function(t){this.y=this.h>=0?t:t-this.h}},mx:{get:function(){return this.w>=0?this.x+this.w:this.x},set:function(t){this.x=this.w>=0?t-this.w:t}},my:{get:function(){return this.h>=0?this.y+this.h:this.y},set:function(t){this.y=this.h>=0?t-this.h:t}}}),i.prototype.contains=function(t,e){return t>=this.nx&&t<this.mx&&e>=this.ny&&e<this.my},i.prototype.applyFill=function(t,e){if("string"!=typeof e)for(var i in e)t[i]=e[i];else t.fillStyle=e},i.prototype.applyStroke=function(t,e){if("string"!=typeof e)for(var i in e)t[i]=e[i];else t.strokeStyle=e},i.prototype.getTextX=function(t){switch(t.textAlign){case"left":return this.nx;case"right":return this.mx;default:return this.cx}},i.prototype.getTextY=function(t){switch(t.textBaseline){case"top":return this.ny;case"bottom":return this.my;default:return this.cy}},i.prototype.render=function(t){t.save();try{this.draw&&(this.draw(t),this.fill&&(this.applyFill(t,this.fill),t.fill()),this.stroke&&(this.applyStroke(t,this.stroke),t.stroke())),this.text&&(this.textFill&&(this.applyFill(t,this.textFill),t.fillText(this.text,this.getTextX(t),this.getTextY(t))),this.textStroke&&(this.applyStroke(t,this.textStroke),t.strokeText(this.text,this.getTextX(t),this.getTextY(t))))}finally{t.restore()}},i.RightAngles=[0,.5*Math.PI,Math.PI,1.5*Math.PI,2*Math.PI],i.drawRect=function(t,e,i,s,n){t.beginPath(),t.rect(e,i,s,n),t.closePath()},i.drawRoundRect=function(t,e,s,n,o,r,h){var a=r*h;e+=a,s+=a,n-=a,o-=a,t.beginPath(),t.arc(e,s,a,i.RightAngles[2],i.RightAngles[3]),t.arc(n,s,a,i.RightAngles[3],i.RightAngles[4]),t.arc(n,o,a,0,i.RightAngles[1]),t.arc(e,o,a,i.RightAngles[1],i.RightAngles[2]),t.closePath()},i.drawCircle=function(t,e,s,n){t.beginPath(),t.arc(e,s,n,0,i.RightAngles[4]),t.closePath()},i.drawPolygon=function(t,e,s,n,o,r){void 0===o&&(o=5),void 0===r&&(r=i.RightAngles[3]),t.beginPath(),t.moveTo(e+n*Math.cos(r),s+n*Math.sin(r));for(var h=i.RightAngles[4]/o,a=1,l=r+h;a<o;a++,l+=h)t.lineTo(e+n*Math.cos(l),s+n*Math.sin(l));t.closePath()},i.drawPolystar=function(t,e,s,n,o,r,h){void 0===o&&(o=5),void 0===r&&(r=i.RightAngles[3]),void 0===h&&(h=.5),t.beginPath(),t.moveTo(e+n*Math.cos(r),s+n*Math.sin(r));var a=n*h,l=i.RightAngles[2]/o,c=r+l;t.lineTo(e+a*Math.cos(c),s+a*Math.sin(c));for(var u=1;u<o;u++)c+=l,t.lineTo(e+n*Math.cos(c),s+n*Math.sin(c)),c+=l,t.lineTo(e+a*Math.cos(c),s+a*Math.sin(c));t.closePath()}},function(t,e,i){!function(){"use strict";var t=i(2),e=i(3);new t(window,new e)}()},function(t,e){function i(t,e){this.window=t,this.stage=e,e.container=this,this.canvas=t.document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.lastFrameTime=0,this.storageCache={};var i=this;function s(t,e,i){t.addEventListener(e,i,!1)}function n(t,e,n){s(i.canvas,t,(function(t){t.preventDefault(),t.stopPropagation();var e=i.convertX(t.clientX),s=i.convertY(t.clientY);0!=n(e,s,t)&&i.request()})),s(i.canvas,e,(function(t){t.preventDefault(),t.stopPropagation();var e=t.changedTouches[0],s=i.convertX(e.clientX),o=i.convertY(e.clientY);0!=n(s,o,t)&&i.request()}))}function o(t,e){s(i.window,t,(function(t){t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),t.stopPropagation(),0!=e(t.key,t)&&i.request())}))}s(t,"DOMContentLoaded",(function(t){i.canvas.style.position="absolute",i.canvas.style.left="0px",i.canvas.style.top="0px",e.background&&(i.canvas.style.background=e.background),i.coordinate(),i.window.document.body.style.overflow="hidden",i.window.document.body.appendChild(i.canvas),i.window.focus(),e.onReady&&0==e.onReady(t)||i.request()})),e.onLoad&&s(this.window,"load",(function(t){0!=e.onLoad(t)&&i.request()})),e.onHashChange&&s(this.window,"hashchange",(function(t){0!=e.onHashChange(i.getHash(),t)&&i.request()})),s(this.window,"resize",(function(t){i.coordinate(),e.onResize&&0==e.onResize(t)||i.request()})),e.onPointerDown&&n("mousedown","touchstart",e.onPointerDown.bind(e)),e.onPointerMove&&n("mousemove","touchmove",e.onPointerMove.bind(e)),e.onPointerUp&&n("mouseup","touchend",e.onPointerUp.bind(e)),e.onKeyDown&&o("keydown",e.onKeyDown.bind(e)),e.onKeyUp&&o("keyup",e.onKeyUp.bind(e))}t.exports=i,i.prototype.coordinate=function(){this.canvas.width=this.window.innerWidth,this.canvas.height=this.window.innerHeight,this.scale=Math.min(this.canvas.width/this.stage.w,this.canvas.height/this.stage.h),this.offsetX=(this.canvas.width-this.stage.w*this.scale)/2,this.offsetY=(this.canvas.height-this.stage.h*this.scale)/2,0!==this.window.scrollTop&&this.window.scrollTo(0,0)},i.prototype.convertX=function(t){return(t-this.offsetX)/this.scale},i.prototype.convertY=function(t){return(t-this.offsetY)/this.scale},i.prototype.request=function(){var t=this;this.window.requestAnimationFrame((function(e){if(e!==t.lastFrameTime&&(t.stage.update&&0!=t.stage.update(e,t.lastFrameTime)&&t.request(),t.lastFrameTime=e,t.stage.render)){t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.save();try{for(var i in t.context.setTransform(t.scale,0,0,t.scale,t.offsetX,t.offsetY),t.context.textAlign="center",t.context.textBaseline="middle",t.context.font="16px sans-serif",t.context.lineWidth=2,t.stage.style)t.context[i]=t.stage.style[i];t.stage.render(t.context)}finally{t.context.restore()}}}))},i.prototype.setTimeout=function(t,e){var i=this;return this.window.setTimeout((function(){0!=t()&&i.request()}),e)},i.prototype.clearTimeout=function(t){this.window.clearTimeout(t)},i.prototype.setInterval=function(t,e){var i=this;return this.window.setInterval((function(){0!=t()&&i.request()}),e)},i.prototype.clearInterval=function(t){this.window.clearInterval(t)},i.prototype.now=function(){return this.window.performance.now()},i.prototype.openUrl=function(t){this.window.parent.location.href=t},i.prototype.getSearchParams=function(){return this.window.location.search?this.window.location.search.substring(1).split("&").reduce((function(t,e){var i=e.split("=").map((function(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}));return t[i[0]]=i[1],t}),{}):{}},i.prototype.getHash=function(){return this.window.location.hash.slice(1)},i.prototype.replaceHash=function(t){this.window.history.replaceState(null,null,t?"#"+t:this.window.location.pathname+this.window.location.search)},i.prototype.getTitle=function(){return this.window.document.title},i.prototype.getItem=function(t){var e=this.storageCache[t];if(void 0===e)try{e=this.window.localStorage.getItem(t)}catch(t){e=null}return e},i.prototype.setItem=function(t,e){"string"!=typeof e&&(e=""+e),this.storageCache[t]=e;try{this.window.localStorage.setItem(t,e)}catch(t){}}},function(t,e,i){var s=i(4),n=i(6),o=i(0);function r(){this.w=360,this.h=360,this.background="#222"}t.exports=r,r.prototype.onReady=function(){var t=this.container.getSearchParams();this.ballCount=parseInt(t.ballCount)||30,this.bulletCount=parseInt(t.bulletCount)||10,this.duration=parseInt(t.duration)||3e4,this.maxScoreKey=["stackshub_balls_score",this.ballCount,this.bulletCount,this.duration].join("_"),this.maxScore=parseInt(this.container.getItem(this.maxScoreKey))||s.calculateScore(this.ballCount,0,0),this.field=new s(30,50,300,300),this.bulletLabel=new o(30,5,100,20,{text:"Bullets",textFill:"white"}),this.bulletOutput=new o(30,25,100,20,{textFill:"white"}),this.scoreLabel=new o(130,5,100,20,{textFill:"white"}),this.scoreOutput=new o(130,25,100,20,{textFill:"white"}),this.durationLabel=new o(230,5,100,20,{text:"Time",textFill:"white"}),this.durationOutput=new o(230,25,100,20,{textFill:"white"}),this.titleLabel=new o(0,80,360,60,{text:this.container.getTitle(),textFill:{fillStyle:"white",font:"32px Arial"}}),this.startButton=new n(90,170,180,60,{stroke:"white",text:"Start",textFill:"white"}),this.readmeButton=new n(90,260,180,60,{stroke:"white",text:"Readme @ GitHub",textFill:"white"}),this.resultButton=new n(90,170,180,60,{stroke:"white",textFill:"white"}),this.resultButton=new n(90,170,180,60,{stroke:"white",textFill:"white"}),this.goHome()},r.prototype.onPointerDown=function(t,e){switch(this.scene){case h.Home:this.startButton.contains(t,e)?this.goPlay():this.readmeButton.contains(t,e)&&this.container.openUrl("https://github.com/stackshub/balls/blob/master/README.md");break;case h.Play:this.field.contains(t,e)&&this.field.onPointerDown(t,e);break;case h.Result:this.resultButton.contains(t,e)&&this.goHome()}},r.prototype.goHome=function(){this.field.init(this.ballCount,this.bulletCount,this.duration),this.bulletOutput.text=this.bulletCount,this.scoreLabel.text="Best Score",this.scoreOutput.text=this.maxScore,this.durationOutput.text=Math.ceil(this.duration/1e3),this.scene=h.Home},r.prototype.goPlay=function(){this.scoreLabel.text="Score",this.field.start(this.container.now()),this.scene=h.Play},r.prototype.goResult=function(){this.field.score>this.maxScore?(this.resultButton.text="New Record",this.maxScore=this.field.score,this.container.setItem(this.maxScoreKey,this.maxScore)):this.field.balls.length?this.field.restDuration?this.resultButton.text="Out of Bullets":this.resultButton.text="Time's Up":this.resultButton.text="Completed",this.scene=h.Result},r.prototype.update=function(){if(this.scene!==h.Play)return!1;var t=this.field.tick(this.container.now());return this.bulletOutput.text=""+this.field.restBulletCount,this.scoreOutput.text=""+this.field.score,this.durationOutput.text=""+Math.ceil(this.field.restDuration/1e3),t||this.goResult(),t},r.prototype.render=function(t){switch(this.scene){case h.Home:this.titleLabel.render(t),this.startButton.render(t),this.readmeButton.render(t);break;case h.Play:this.field.render(t);break;case h.Result:this.field.render(t),this.resultButton.render(t)}this.bulletLabel.render(t),this.bulletOutput.render(t),this.scoreLabel.render(t),this.scoreOutput.render(t),this.durationLabel.render(t),this.durationOutput.render(t)};var h={Home:0,Play:1,Result:2}},function(t,e,i){var s=i(0),n=i(5);function o(t,e,i,n){s.call(this,t,e,i,n)}t.exports=o,o.prototype=Object.create(s.prototype),o.prototype.init=function(t,e,i){this.ballCount=t,this.restBulletCount=e,this.restDuration=i,this.score=0,this.gravity=5e-4,this.balls=new Array(this.ballCount),this.ballR=30,this.ballRR=this.ballR*this.ballR;for(var o=0;o<this.ballCount;o++){var a=.2*Math.random(),l=2*Math.PI*Math.random();this.balls[o]=new n(this.x+this.w*Math.random(),this.y+this.h*Math.random()*.8,this.ballR,{fill:h[o%3+1],vx:a*Math.cos(l),vy:a*Math.sin(l)})}for(var c=0;c<500;c++)this.tickBalls(20);this.removeBalls=[],this.mark=new s(0,0,20,20,{textFill:h[0]}),this.state=r.Ready},o.prototype.onPointerDown=function(t,e){this.restBulletCount<=0||(this.state===r.Running?(this.pause(),this.balls.length<=1&&this.shoot(t,e)):this.state===r.Waiting&&this.shoot(t,e))},o.prototype.start=function(t){this.lastTickTime=t,this.state=r.Running},o.prototype.pause=function(){this.removeBalls.length=0,this.mark.text=null,this.state=r.Waiting},o.prototype.shoot=function(t,e){for(var i=this.balls.length-1;i>=0;i--){var s=this.balls[i],n=t-s.cx,a=e-s.cy;n*n+a*a>this.ballRR||(this.balls.splice(i,1),s.stroke=s.fill,s.fill=null,this.removeBalls.push(s))}if(this.score+=o.calculateScore(this.removeBalls.length,0,0),this.mark.text=""+this.removeBalls.length,this.mark.cx=t,this.mark.cy=e,this.restBulletCount--,!this.balls.length)return this.score+=o.calculateScore(0,this.restBulletCount,this.restDuration),void(this.state=r.Finished);this.restBulletCount?(this.balls.length<=1&&(this.balls[0].fill=h[0]),this.state=r.Running):this.state=r.Finished},o.prototype.tick=function(t){if(this.state===r.Finished)return!1;var e=t-this.lastTickTime;return this.lastTickTime=t,this.restDuration-=e,this.restDuration<=0?(this.restDuration=0,this.state=r.Finished,!1):(this.state===r.Waiting&&(e*=.01),this.tickBalls(e*(3-2*this.balls.length/this.ballCount)),!0)},o.prototype.tickBalls=function(t){for(var e=0;e<this.balls.length;e++){var i=this.balls[e];i.x+=i.vx*t,i.cx<this.x?(i.cx=2*this.x-i.cx,i.vx*=-1):i.cx>this.mx&&(i.cx=2*this.mx-i.cx,i.vx*=-1),i.vy+=this.gravity*t,i.y+=i.vy*t,i.cy>this.my&&(i.cy=2*this.my-i.cy,i.vy*=-1)}},o.prototype.render=function(t){t.save();try{t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.fillStyle="black",t.fill(),t.clip(),t.globalCompositeOperation="lighter";for(var e=0;e<this.balls.length;e++)this.balls[e].render(t);for(var i=0;i<this.removeBalls.length;i++)this.removeBalls[i].render(t);this.mark.render(t)}finally{t.restore()}},o.calculateScore=function(t,e,i){return 1e3*t+100*e+Math.ceil(i/1e3)};var r={Ready:0,Running:1,Waiting:2,Finished:3},h=["#ccc","#c00","#0c0","#00c"]},function(t,e,i){var s=i(0);function n(t,e,i,n){var o=2*i;s.call(this,t-i,e-i,o,o,n)}t.exports=n,n.prototype=Object.create(s.prototype),n.prototype.draw=function(t){s.drawCircle(t,this.cx,this.cy,this.r)}},function(t,e,i){var s=i(0);function n(t,e,i,n,o){s.call(this,t,e,i,n,o),void 0===this.roundFactor&&(this.roundFactor=.5)}t.exports=n,n.prototype=Object.create(s.prototype),n.prototype.draw=function(t){s.drawRoundRect(t,this.nx,this.ny,this.mx,this.my,this.r,this.roundFactor)}}]);
//# sourceMappingURL=index.min.js.map